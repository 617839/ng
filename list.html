<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>列表</title>
    <link rel="stylesheet" type="text/css" media="all" href="assets/css/style.css"/>
    <link rel="stylesheet" type="text/css" media="all" href="assets/css/visual.css"/>

    <script src="assets/js/library/jquery.min.js"></script>
    <script src="assets/js/libs/d3.min.js"></script>
    <script src="data/33.js"></script>
    <script src="assets/js/help.js"></script>
    <script src="assets/js/doc.js"></script>
    <script src="assets/js/init.js"></script>
</head>
<body>
<aside>
    <button data-type="upMarginRef">上间隔</button>
    <button data-type="downMarginRef" class="current">下间隔</button>
    <button data-type="singleDigitRef">数尾</button>
</aside>
<div class="container">
    <div class="title"></div>
    <ul class="content"></ul>
</div>

<script>

    var view = function (data) {

        var m = 40;
        var h = 20;

        //////////////////////////////////////////////////

        var i = d3.select('.title').selectAll('i')
                .data(d3.range(0, 36));

        i.enter()
                .append('i');

        i.text(function (d) {
            return d;
        })
                .style('left', function (d) {
                    return (d) * m + (d + 1) * 1 + 'px';
                });

        //////////////////////////////////////////////////

        var li = d3.select(".content").selectAll("li")
                .data(data);

        li.enter().append("li");

        //li.style('top', function(d, i) {
        //return i * h + (i + 1) * 1 + 'px';
        //});

        li.exit().remove();

        //////////////////////////////////////////////////

        var p = li.selectAll('p')
                .data(d3.values);

        p.enter().append("p");

        p.transition().duration(500)
                .style('left', function (d, i) {
                    return i * 8 * 41 + 'px';
                });

        p.exit().remove();

        //////////////////////////////////////////////////

        var em = p.selectAll('em')
                .data(function (d) {
                    return d;
                });

        em.enter().append("em");

        em.text(function (d) {
            return d;
        })
                .transition().duration(500)
                .style('left', function (d, i) {
                    return i * m + (i + 1) * 1 + 'px';
                });

        em.exit().remove();

        $('body').scrollTop((data.length - 20) * 21);
    };

    ////////////////////////////////////////////////////////

    $('aside button').click(function () {
        var th = $(this);
        var type = th.attr('data-type');
        var data = NGGLOBAL[type].slice(NGGLOBAL[type].length - 60);

        th.addClass('current');
        th.siblings().removeClass('current');

        $('title').text('列表' + type);

        data = groupRefListModel(data);
        view(data);
    });

    ////////////////////////////////////////////////////////
    //init

    var type = getUrlParam('type') || $('aside button.current').attr('data-type');
    var push = getUrlParam('push');

    var data = NGGLOBAL[type].slice(NGGLOBAL[type].length - 60);

    if (push) {
        data.push(JSON.parse(push));
    }

    data = groupRefListModel(data);

    view(data);

</script>
</body>
</html>
