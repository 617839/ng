<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>count down</title>
    <link rel="stylesheet" type="text/css" href="../../css/common/base.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/common/common.css"/>
    <script src="../../js/vendor/underscore-1.6.0.min.js"></script>
    <script src="../../js/vendor/jquery.min.js"></script>
    <script src="../../js/vendor/d3.min.js"></script>
    <script src="../../js/common/getData.js"></script>
    <script src="../../js/common/help.js"></script>
    <script src="../../js/common/common.js"></script>
    <style>
        html, body{
            min-height: 100%;
            background: url(../../css/common/img/bg3.png) repeat 0 0;
        }
        body{
            line-height: 1;
        }
        h6, div, em{
            display: inline-block;
            vertical-align: middle;
        }
        h6,em{
            width:41px;
            height: 21px;
            line-height: 22px;
            text-align: center;
        }
        h6{
            text-align: right;
            overflow: hidden;
            margin-right:41px;
            direction: rtl;
        }
        aside{
            background: #dfe3e8;
            position: fixed;
            right:0;
            top:0;
            height: 100%;
            padding:10px;
        }
    </style>
</head>
<body>

<aside>
</aside>

<main>
<ul class="list">

</ul>
</main>

<script>

    !function(){

        var data = downMarginRef;

        var filters = {

            first : {
                code : 'first',
                tag : '0开头',
                handle : function(current, prev){
                    current.tags[this.code] = _.indexOf(current.uniq, 0) === 0;
                }
            },

            allOddOrEven : {
                code:'allOddOrEven',
                tag : '全奇偶',
                handle : function(current){
                    var arr = current.uniq;
                    var isOdd = arr.every(function(item){
                        return item % 2 == 0;
                    });
                    var isEven = arr.every(function(item){
                        return item % 2 == 1;
                    });
                    current.tags[this.code] = isOdd || isEven;
                }
            },

            same : {
                code:'same',
                tag: '相同',
                handle : function(current){
                    var count =  _.countBy(current.original, function(item){
                        return item;
                    });
                    current.same = count;
                    current.tags[this.code] = _.every(count, function(v, k){
                         return v > 1 && k < 4;
                    });
                }
            }

        };

        var list = groupRefListModel(data);

        _.each({original:'group', uniq: 'unique', cys: 'loca'}, function(v, k){

            for(var i in list){
                var item = list[i];
                item[k] = item[v];
                delete item[v];
            }

        });

        list.reduce(function(prev, current, index, list){

            current.tags = {};

            _.forEach(filters, function(filter){

                filter.handle(current, prev);

            });

            return current;
        });


        console.log(list);

    }();







</script>
</body>
</html>